\hypertarget{classServer}{}\doxysection{Класс Server}
\label{classServer}\index{Server@{Server}}


Класс сетевого сервера.  




{\ttfamily \#include $<$server.\+h$>$}



Граф связей класса Server\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=139pt]{classServer__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Открытые члены}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classServer_a65f89e69611c4aaace1a6fd48259b1ca}{Server}} (int \mbox{\hyperlink{classServer_a926c9dae229a62b6d33fdbb41dca6d82}{port}}, const std\+::string \&\mbox{\hyperlink{classServer_a05c13ca23c4f88ff81c1808003d93740}{data}}, \mbox{\hyperlink{classLogger}{Logger}} \&\mbox{\hyperlink{classServer_a3c1f558b24a485a61822b50d3a02192a}{logger}})
\begin{DoxyCompactList}\small\item\em Конструктор класса \mbox{\hyperlink{classServer}{Server}}. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classServer_ab6d3d945254ef29f56ceb51b73fe6d61}{Server}} ()=delete
\item 
\mbox{\hyperlink{classServer_a4b3aa2579cb1c8cd1d069582c14d0fa6}{$\sim$\+Server}} ()
\item 
void \mbox{\hyperlink{classServer_a7eac07d2582fa01c2671362efa955b31}{start}} ()
\begin{DoxyCompactList}\small\item\em Запускает сервер. В бесконечном цикле принимает соединения от клиентов и обрабатывает их. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Закрытые члены}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{classServer_af21534aeb91a10d3bb22169a1ee06d59}{handle\+Client}} (int client\+\_\+socket)
\begin{DoxyCompactList}\small\item\em Обрабатывает соединение с клиентом. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classServer_ad8e6454481fa397d732cb23dc1f75473}{listen\+\_\+socket}} ()
\begin{DoxyCompactList}\small\item\em Начинает прослушивание сокета на наличие входящих соединений. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Закрытые данные}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{classServer_a926c9dae229a62b6d33fdbb41dca6d82}{port}}
\begin{DoxyCompactList}\small\item\em Порт сервера \end{DoxyCompactList}\item 
std\+::string \mbox{\hyperlink{classServer_a05c13ca23c4f88ff81c1808003d93740}{data}}
\begin{DoxyCompactList}\small\item\em Данные для отправки клиентам \end{DoxyCompactList}\item 
\mbox{\hyperlink{classLogger}{Logger}} \& \mbox{\hyperlink{classServer_a3c1f558b24a485a61822b50d3a02192a}{logger}}
\begin{DoxyCompactList}\small\item\em Объект для логирования \end{DoxyCompactList}\item 
int \mbox{\hyperlink{classServer_a597fe0c56c29950a94d078d362fed51a}{server\+\_\+socket}}
\begin{DoxyCompactList}\small\item\em Дескриптор серверного сокета \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Подробное описание}
Класс сетевого сервера. 

Принимает соединения от клиентов, обрабатывает их и отправляет данные. Использует класс \mbox{\hyperlink{classLogger}{Logger}} для логирования событий. 

\doxysubsection{Конструктор(ы)}
\mbox{\Hypertarget{classServer_a65f89e69611c4aaace1a6fd48259b1ca}\label{classServer_a65f89e69611c4aaace1a6fd48259b1ca}} 
\index{Server@{Server}!Server@{Server}}
\index{Server@{Server}!Server@{Server}}
\doxysubsubsection{\texorpdfstring{Server()}{Server()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily Server\+::\+Server (\begin{DoxyParamCaption}\item[{int}]{port,  }\item[{const std\+::string \&}]{data,  }\item[{\mbox{\hyperlink{classLogger}{Logger}} \&}]{logger }\end{DoxyParamCaption})}



Конструктор класса \mbox{\hyperlink{classServer}{Server}}. 


\begin{DoxyParams}{Аргументы}
{\em port} & Порт сервера. \\
\hline
{\em data} & Данные для отправки клиентам. \\
\hline
{\em logger} & Объект для логирования. \\
\hline
\end{DoxyParams}

\begin{DoxyExceptions}{Исключения}
{\em std\+::system\+\_\+error} & При ошибках создания или привязки сокета. \\
\hline
{\em std\+::system\+\_\+error} & При указании неверного номера порта. \\
\hline
\end{DoxyExceptions}

\begin{DoxyCode}{0}
\DoxyCodeLine{23     : \mbox{\hyperlink{classServer_a926c9dae229a62b6d33fdbb41dca6d82}{port}}(\mbox{\hyperlink{classServer_a926c9dae229a62b6d33fdbb41dca6d82}{port}})}
\DoxyCodeLine{24     , \mbox{\hyperlink{classServer_a05c13ca23c4f88ff81c1808003d93740}{data}}(\mbox{\hyperlink{classServer_a05c13ca23c4f88ff81c1808003d93740}{data}})}
\DoxyCodeLine{25     , \mbox{\hyperlink{classServer_a3c1f558b24a485a61822b50d3a02192a}{logger}}(\mbox{\hyperlink{classServer_a3c1f558b24a485a61822b50d3a02192a}{logger}}) }
\DoxyCodeLine{26 \{}
\DoxyCodeLine{27     \textcolor{keywordflow}{if} (port < 1 || port > 65535) \{}
\DoxyCodeLine{28         \textcolor{keywordflow}{throw} std::system\_error(EINVAL, std::generic\_category(), \textcolor{stringliteral}{"{}Неправильный порт: "{}} + to\_string(\mbox{\hyperlink{classServer_a926c9dae229a62b6d33fdbb41dca6d82}{port}}));}
\DoxyCodeLine{29     \}}
\DoxyCodeLine{30     \mbox{\hyperlink{classServer_a3c1f558b24a485a61822b50d3a02192a}{logger}}.\mbox{\hyperlink{classLogger_a3d3f0801eeaf39b33a906ea8569c19b2}{log}}(\mbox{\hyperlink{Logger_8h_aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806}{INFO}}, \textcolor{stringliteral}{"{}Создание сервера на порту "{}} + std::to\_string(\mbox{\hyperlink{classServer_a926c9dae229a62b6d33fdbb41dca6d82}{port}}));}
\DoxyCodeLine{31 }
\DoxyCodeLine{32     \mbox{\hyperlink{classServer_a597fe0c56c29950a94d078d362fed51a}{server\_socket}} = socket(AF\_INET, SOCK\_STREAM, 0);}
\DoxyCodeLine{33     \textcolor{keywordflow}{if}(\mbox{\hyperlink{classServer_a597fe0c56c29950a94d078d362fed51a}{server\_socket}} == -\/1) \{}
\DoxyCodeLine{34         std::string error\_message = strerror(errno);}
\DoxyCodeLine{35         std::string exception\_message = \textcolor{stringliteral}{"{}Ошибка создания сокета: "{}} + error\_message;}
\DoxyCodeLine{36         \mbox{\hyperlink{classServer_a3c1f558b24a485a61822b50d3a02192a}{logger}}.\mbox{\hyperlink{classLogger_a3d3f0801eeaf39b33a906ea8569c19b2}{log}}(\mbox{\hyperlink{Logger_8h_aca1fd1d8935433e6ba2e3918214e07f9acda21a4a072f2261f6d4ab596599f8b0}{CRITICAL}}, exception\_message);}
\DoxyCodeLine{37         \textcolor{keywordflow}{throw} std::system\_error(errno, std::generic\_category(), exception\_message);}
\DoxyCodeLine{38     \}}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     sockaddr\_in server\_addr\{\};}
\DoxyCodeLine{41     server\_addr.sin\_family = AF\_INET;}
\DoxyCodeLine{42     server\_addr.sin\_addr.s\_addr = INADDR\_ANY;}
\DoxyCodeLine{43     server\_addr.sin\_port = htons(\mbox{\hyperlink{classServer_a926c9dae229a62b6d33fdbb41dca6d82}{port}});}
\DoxyCodeLine{44 }
\DoxyCodeLine{45     \textcolor{keywordflow}{if}(bind(\mbox{\hyperlink{classServer_a597fe0c56c29950a94d078d362fed51a}{server\_socket}}, (\textcolor{keyword}{struct} sockaddr*)\&server\_addr, \textcolor{keyword}{sizeof}(server\_addr)) == -\/1) \{}
\DoxyCodeLine{46         std::string error\_message = strerror(errno);}
\DoxyCodeLine{47         std::string exception\_message = \textcolor{stringliteral}{"{}Ошибка привязки сокета: "{}} + error\_message;}
\DoxyCodeLine{48         \mbox{\hyperlink{classServer_a3c1f558b24a485a61822b50d3a02192a}{logger}}.\mbox{\hyperlink{classLogger_a3d3f0801eeaf39b33a906ea8569c19b2}{log}}(\mbox{\hyperlink{Logger_8h_aca1fd1d8935433e6ba2e3918214e07f9acda21a4a072f2261f6d4ab596599f8b0}{CRITICAL}}, exception\_message);}
\DoxyCodeLine{49         \textcolor{keywordflow}{throw} std::system\_error(errno, std::generic\_category(), exception\_message);}
\DoxyCodeLine{50     \}}
\DoxyCodeLine{51 }
\DoxyCodeLine{52     \mbox{\hyperlink{classServer_ad8e6454481fa397d732cb23dc1f75473}{listen\_socket}}();}
\DoxyCodeLine{53 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classServer_ab6d3d945254ef29f56ceb51b73fe6d61}\label{classServer_ab6d3d945254ef29f56ceb51b73fe6d61}} 
\index{Server@{Server}!Server@{Server}}
\index{Server@{Server}!Server@{Server}}
\doxysubsubsection{\texorpdfstring{Server()}{Server()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily Server\+::\+Server (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [delete]}}

\mbox{\Hypertarget{classServer_a4b3aa2579cb1c8cd1d069582c14d0fa6}\label{classServer_a4b3aa2579cb1c8cd1d069582c14d0fa6}} 
\index{Server@{Server}!````~Server@{$\sim$Server}}
\index{````~Server@{$\sim$Server}!Server@{Server}}
\doxysubsubsection{\texorpdfstring{$\sim$Server()}{~Server()}}
{\footnotesize\ttfamily Server\+::$\sim$\+Server (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{57 \{\}}

\end{DoxyCode}


\doxysubsection{Методы}
\mbox{\Hypertarget{classServer_af21534aeb91a10d3bb22169a1ee06d59}\label{classServer_af21534aeb91a10d3bb22169a1ee06d59}} 
\index{Server@{Server}!handleClient@{handleClient}}
\index{handleClient@{handleClient}!Server@{Server}}
\doxysubsubsection{\texorpdfstring{handleClient()}{handleClient()}}
{\footnotesize\ttfamily void Server\+::handle\+Client (\begin{DoxyParamCaption}\item[{int}]{client\+\_\+socket }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Обрабатывает соединение с клиентом. 


\begin{DoxyParams}{Аргументы}
{\em client\+\_\+socket} & Дескриптор сокета клиента. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{classServer_ad8e6454481fa397d732cb23dc1f75473}\label{classServer_ad8e6454481fa397d732cb23dc1f75473}} 
\index{Server@{Server}!listen\_socket@{listen\_socket}}
\index{listen\_socket@{listen\_socket}!Server@{Server}}
\doxysubsubsection{\texorpdfstring{listen\_socket()}{listen\_socket()}}
{\footnotesize\ttfamily void Server\+::listen\+\_\+socket (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Начинает прослушивание сокета на наличие входящих соединений. 


\begin{DoxyCode}{0}
\DoxyCodeLine{16 \{}
\DoxyCodeLine{17     \textcolor{keywordflow}{if}(listen(\mbox{\hyperlink{classServer_a597fe0c56c29950a94d078d362fed51a}{server\_socket}}, 5) == -\/1) \{}
\DoxyCodeLine{18         \textcolor{keywordflow}{throw} std::system\_error(errno, std::generic\_category(), \textcolor{stringliteral}{"{}Ошибка прослушивания сокета"{}});}
\DoxyCodeLine{19     \}}
\DoxyCodeLine{20 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classServer_a7eac07d2582fa01c2671362efa955b31}\label{classServer_a7eac07d2582fa01c2671362efa955b31}} 
\index{Server@{Server}!start@{start}}
\index{start@{start}!Server@{Server}}
\doxysubsubsection{\texorpdfstring{start()}{start()}}
{\footnotesize\ttfamily void Server\+::start (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Запускает сервер. В бесконечном цикле принимает соединения от клиентов и обрабатывает их. 


\begin{DoxyExceptions}{Исключения}
{\em std\+::system\+\_\+error} & При ошибках приема соединения. \\
\hline
\end{DoxyExceptions}

\begin{DoxyCode}{0}
\DoxyCodeLine{56 \{}
\DoxyCodeLine{57     \textcolor{keywordflow}{while}(\textcolor{keyword}{true}) \{}
\DoxyCodeLine{58         sockaddr\_in client\_addr\{\};}
\DoxyCodeLine{59         socklen\_t client\_addr\_size = \textcolor{keyword}{sizeof}(client\_addr);}
\DoxyCodeLine{60 }
\DoxyCodeLine{61         \textcolor{keywordtype}{int} client\_socket = accept(\mbox{\hyperlink{classServer_a597fe0c56c29950a94d078d362fed51a}{server\_socket}}, (\textcolor{keyword}{struct} sockaddr*)\&client\_addr, \&client\_addr\_size);}
\DoxyCodeLine{62         \textcolor{keywordflow}{if}(client\_socket == -\/1) \{}
\DoxyCodeLine{63             std::string error\_message = strerror(errno);}
\DoxyCodeLine{64             std::string exception\_message = \textcolor{stringliteral}{"{}Ошибка при приёме соединения: "{}} + error\_message;}
\DoxyCodeLine{65             \mbox{\hyperlink{classServer_a3c1f558b24a485a61822b50d3a02192a}{logger}}.\mbox{\hyperlink{classLogger_a3d3f0801eeaf39b33a906ea8569c19b2}{log}}(\mbox{\hyperlink{Logger_8h_aca1fd1d8935433e6ba2e3918214e07f9acda21a4a072f2261f6d4ab596599f8b0}{CRITICAL}}, exception\_message);}
\DoxyCodeLine{66             \textcolor{keywordflow}{throw} std::system\_error(errno, std::generic\_category(), exception\_message);}
\DoxyCodeLine{67         \}}
\DoxyCodeLine{68         std::string client\_ip = inet\_ntoa(client\_addr.sin\_addr);}
\DoxyCodeLine{69         \mbox{\hyperlink{classServer_a3c1f558b24a485a61822b50d3a02192a}{logger}}.\mbox{\hyperlink{classLogger_a3d3f0801eeaf39b33a906ea8569c19b2}{log}}(\mbox{\hyperlink{Logger_8h_aca1fd1d8935433e6ba2e3918214e07f9a748005382152808a72b1a9177d9dc806}{INFO}}, \textcolor{stringliteral}{"{}Новое подключение от "{}} + client\_ip);}
\DoxyCodeLine{70         \mbox{\hyperlink{classCommunicator}{Communicator}} communicator(client\_socket, \mbox{\hyperlink{classServer_a05c13ca23c4f88ff81c1808003d93740}{data}}, \mbox{\hyperlink{classServer_a3c1f558b24a485a61822b50d3a02192a}{logger}});}
\DoxyCodeLine{71         communicator.handleClient();}
\DoxyCodeLine{72         close(client\_socket);}
\DoxyCodeLine{73     \}}
\DoxyCodeLine{74 \}}

\end{DoxyCode}


\doxysubsection{Данные класса}
\mbox{\Hypertarget{classServer_a05c13ca23c4f88ff81c1808003d93740}\label{classServer_a05c13ca23c4f88ff81c1808003d93740}} 
\index{Server@{Server}!data@{data}}
\index{data@{data}!Server@{Server}}
\doxysubsubsection{\texorpdfstring{data}{data}}
{\footnotesize\ttfamily std\+::string Server\+::data\hspace{0.3cm}{\ttfamily [private]}}



Данные для отправки клиентам 

\mbox{\Hypertarget{classServer_a3c1f558b24a485a61822b50d3a02192a}\label{classServer_a3c1f558b24a485a61822b50d3a02192a}} 
\index{Server@{Server}!logger@{logger}}
\index{logger@{logger}!Server@{Server}}
\doxysubsubsection{\texorpdfstring{logger}{logger}}
{\footnotesize\ttfamily \mbox{\hyperlink{classLogger}{Logger}}\& Server\+::logger\hspace{0.3cm}{\ttfamily [private]}}



Объект для логирования 

\mbox{\Hypertarget{classServer_a926c9dae229a62b6d33fdbb41dca6d82}\label{classServer_a926c9dae229a62b6d33fdbb41dca6d82}} 
\index{Server@{Server}!port@{port}}
\index{port@{port}!Server@{Server}}
\doxysubsubsection{\texorpdfstring{port}{port}}
{\footnotesize\ttfamily int Server\+::port\hspace{0.3cm}{\ttfamily [private]}}



Порт сервера 

\mbox{\Hypertarget{classServer_a597fe0c56c29950a94d078d362fed51a}\label{classServer_a597fe0c56c29950a94d078d362fed51a}} 
\index{Server@{Server}!server\_socket@{server\_socket}}
\index{server\_socket@{server\_socket}!Server@{Server}}
\doxysubsubsection{\texorpdfstring{server\_socket}{server\_socket}}
{\footnotesize\ttfamily int Server\+::server\+\_\+socket\hspace{0.3cm}{\ttfamily [private]}}



Дескриптор серверного сокета 



Объявления и описания членов классов находятся в файлах\+:\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{server_8h}{server.\+h}}\item 
\mbox{\hyperlink{server_8cpp}{server.\+cpp}}\end{DoxyCompactItemize}
